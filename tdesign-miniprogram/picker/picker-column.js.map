{"version":3,"sources":["../src/picker/picker-column.ts"],"names":[],"mappings":"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","file":"picker-column.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './picker-item-props';\n\nconst itemHeight = 80;\nconst DefaultDuration = 600;\n\nconst { windowWidth } = wx.getSystemInfoSync();\n\nconst rpx2px = (rpx) => Math.floor((windowWidth * rpx) / 750);\n\nconst range = function (num: number, min: number, max: number) {\n  return Math.min(Math.max(num, min), max);\n};\n\n@wxComponent()\nexport default class PickerColumn extends SuperComponent {\n  relations = {\n    './picker': {\n      type: 'parent' as 'parent',\n    },\n  };\n\n  properties = props;\n\n  observers = {\n    value(this: PickerColumn) {\n      this.updateColumns();\n    },\n    options(this: PickerColumn) {\n      this.updateColumns();\n    },\n  };\n\n  data = {\n    prefix: `${config.prefix}-picker-column`,\n    offset: 0, // 滚动偏移量\n    duration: 0, // 滚动动画延迟\n  };\n\n  methods = {\n    onTouchStart(event) {\n      this.StartY = event.touches[0].clientY;\n      this.StartOffset = this.data.offset;\n      this.setData({ duration: 0 });\n    },\n\n    onTouchMove(event) {\n      const { StartY, StartOffset, itemHeight } = this;\n\n      // touch偏移增量\n      const touchDeltaY = event.touches[0].clientY - StartY;\n      const deltaY = this.calculateViewDeltaY(touchDeltaY);\n\n      this.setData({\n        offset: range(StartOffset + deltaY, -(this.getCount() * itemHeight), 0),\n        duration: DefaultDuration,\n      });\n    },\n\n    onTouchEnd() {\n      const { offset } = this.data;\n      const { options } = this.properties;\n\n      if (offset === this.StartOffset) {\n        return;\n      }\n      // 调整偏移量\n      const index = range(Math.round(-offset / this.itemHeight), 0, this.getCount() - 1);\n      this.setData({\n        offset: -index * this.itemHeight,\n      });\n\n      if (index === this._selectedIndex) {\n        return;\n      }\n\n      wx.nextTick(() => {\n        const changeObj = {\n          index,\n          value: options[index],\n        };\n\n        this._selectedIndex = index;\n        this._selectedValue = options[index];\n        this.triggerEvent('change', changeObj);\n\n        const picker = this.getRelationNodes('./picker')?.[0];\n        if (picker) {\n          picker.triggerChange({\n            ...changeObj,\n            column: this.columnIndex || 0,\n          });\n        }\n      });\n    },\n\n    // 刷新选中状态\n    updateColumns() {\n      const { options, value } = this.properties;\n\n      const index = options.findIndex((item) => item.value === value);\n      const selectedIndex = index > 0 ? index : 0;\n\n      this.setData({ offset: -selectedIndex * this.itemHeight });\n\n      this._selectedIndex = selectedIndex;\n      this._selectedValue = options[selectedIndex];\n    },\n\n    resetOrigin() {\n      this.updateColumns();\n    },\n\n    getCount() {\n      return this.data?.options?.length;\n    },\n  };\n\n  /**\n   * 将屏幕滑动距离换算为视图偏移量 模拟渐进式滚动\n   * @param touchDeltaY 屏幕滑动距离\n   */\n  calculateViewDeltaY(touchDeltaY: number): number {\n    return Math.abs(touchDeltaY) > itemHeight ? 1.2 * touchDeltaY : touchDeltaY;\n  }\n\n  created() {\n    this.StartY = 0;\n    this.StartOffset = 0;\n    this.itemHeight = rpx2px(itemHeight);\n  }\n}\n"]}