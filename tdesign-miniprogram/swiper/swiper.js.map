{"version":3,"sources":["../src/swiper/swiper.ts"],"names":[],"mappings":"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","file":"swiper.js","sourcesContent":["/**\n * 轮播组件\n * 因原生swiper受限，基于wxs重新实现，后期可以扩展更多丰富的功能\n * todo：无限循环，3D动效等\n */\nimport { SuperComponent, wxComponent, ControlInstance, useControl } from '../common/src/index';\nimport config from '../common/config';\nimport { DIRECTION, NavTypes } from './common/constants';\nimport props from './props';\n\nconst { prefix } = config;\nconst easings = {\n  // 线性动画\n  linear: 'linear',\n  // 缓入动画\n  // https://easings.net/#easeInCubic\n  easeInCubic: 'cubic-bezier(0.32, 0, 0.67, 0)',\n  // 缓出动画\n  // https://easings.net/#easeOutCubic\n  easeOutCubic: 'cubic-bezier(0.33, 1, 0.68, 1)',\n  // 缓入缓出动画\n  // https://easings.net/#easeInOutCubic\n  easeInOutCubic: 'cubic-bezier(0.65, 0, 0.35, 1)',\n};\n\ninterface SwitchOpt {\n  cycle?: boolean;\n  source: 'autoplay' | 'touch' | 'nav';\n}\nconst defaultNavigation = {\n  type: NavTypes.dots,\n  minShowNum: 2,\n  hasNavBtn: false,\n};\n\n@wxComponent()\nexport default class Swiper extends SuperComponent {\n  externalClasses = [`${prefix}-class`];\n\n  options = {\n    multipleSlots: true,\n  };\n\n  properties = props;\n\n  observers = {\n    navigation(val) {\n      this.setData({\n        _navigation: { ...defaultNavigation, ...val },\n      });\n    },\n    current(val) {\n      this.update(+val);\n    },\n    autoplay(val) {\n      if (val) {\n        this.play();\n      } else {\n        this.pause();\n      }\n    },\n    interval(val) {\n      if (this._old_interval && this._old_interval !== val) {\n        this.replay();\n      }\n      this._old_interval = val;\n    },\n    direction(val) {\n      // 属性变化时，重新初始化\n      if (this._old_direction && this._old_direction !== val) {\n        this.initItem();\n      }\n      this._old_direction = val;\n    },\n  };\n\n  children = null;\n\n  $nav = null;\n\n  timer = null;\n\n  // 受控属性\n  control: ControlInstance = null;\n\n  relations = {\n    './swiper-item': {\n      type: 'child' as 'child',\n    },\n    './swiper-nav': {\n      type: 'child' as 'child',\n    },\n  };\n\n  data = {\n    // 内部状态：当前临时索引\n    _current: 0,\n    // 内部取默认值后的配置\n    _navigation: null,\n    // 容器宽\n    _width: 0,\n    // 容器高\n    _height: 0,\n    offsetX: 0,\n    // todo\n    offsetY: 0,\n    // 列表项总数\n    total: 0,\n\n    easings,\n    // js和wxs等初始化就绪\n    inited: false,\n    // current初始化的值就绪\n    currentInited: false,\n    prefix,\n    classPrefix: `.${prefix}-swiper`,\n  };\n\n  attached() {\n    // 暂停完全受控模式，待TD全量支持受控后，再开启\n    // this.control = useControl.call(this, {\n    //   valueKey: 'current',\n    //   defaultValueKey: 'defaultCurrent',\n    // });\n    // 启用半受控模式\n    this.control = useControl.call(this, {\n      valueKey: 'current',\n      strict: false,\n    });\n    this.createSelectorQuery()\n      .select('#swiper')\n      .boundingClientRect((rect) => {\n        this.setData({\n          _width: rect.width,\n          _height: rect.height,\n        });\n        this.initCurrent();\n      })\n      .exec();\n  }\n\n  detached() {\n    this.pause();\n  }\n\n  ready() {\n    this.initItem();\n    this.initNav();\n  }\n\n  /**\n   * 初始化 swiper-item\n   */\n  initItem() {\n    const { direction } = this.properties;\n    this.children = this.getRelationNodes('./swiper-item');\n    this.children.forEach((item, index) => {\n      item.setIndex(index, direction);\n    });\n    this.setData({\n      total: this.children.length,\n    });\n  }\n\n  /**\n   * 初始化 swiper-nav\n   */\n  initNav() {\n    const { _navigation } = this.data;\n    if (_navigation) {\n      // 启用内部导航器\n      this.$nav = this.selectComponent('#swiperNav');\n    } else {\n      // 启用插槽嵌入的导航器\n      this.$nav = this.getRelationNodes('./swiper-nav')?.[0];\n    }\n  }\n\n  /**\n   * 初始化也需要等待wxs完成，由wxs触发inited\n   */\n  inited() {\n    this.updateNav(this.control.get());\n    this.setData({\n      inited: true,\n    });\n  }\n\n  /**\n   * 初始化current\n   * 需要通过wxs更新位置，存在短暂延迟\n   */\n  initCurrent() {\n    const index = this.control.initValue;\n    this.control.set(index, {\n      currentInited: true,\n      // 默认为0时，不需要等待wxs计算位置，可直接显示\n      inited: index === 0,\n      ...this.calcOffset(index as any),\n    });\n  }\n\n  play() {\n    this.pause();\n    const { interval } = this.properties;\n    this.timer = setInterval(() => {\n      const { inited } = this.data;\n      if (!inited) return;\n      this.next({ cycle: true, source: 'autoplay' });\n    }, interval as any);\n  }\n\n  replay() {\n    const { autoplay } = this.properties;\n    autoplay && this.play();\n  }\n\n  pause() {\n    this.timer && clearInterval(this.timer);\n    this.timer = null;\n  }\n\n  /**\n   * 跳转目标页\n   * @param index 目标页索引\n   * @param source 来源标记\n   * @returns\n   */\n  goto(index: number, source: string) {\n    if (this.control.get() === index) {\n      this.update(index);\n      return;\n    }\n    this.control.change(\n      index,\n      {\n        current: index,\n        source,\n      },\n      () => {\n        this.update(index);\n      },\n    );\n  }\n\n  /**\n   * 更新目标页\n   * @param index 目标页索引（一页可能有多个item）\n   * @returns\n   */\n  update(index: number, finish?) {\n    if (!this.children) return;\n    const len = this.children.length;\n    let fixIndex = +index;\n    if (Number.isNaN(fixIndex)) return;\n    if (fixIndex <= 0) {\n      fixIndex = 0;\n    } else if (fixIndex > len - 1) {\n      fixIndex = len - 1;\n    }\n    this.updateNav(fixIndex);\n    this.control.set(fixIndex, this.calcOffset(fixIndex), finish);\n  }\n\n  /**\n   * 更新导航器\n   * @param index\n   */\n  updateNav(index) {\n    if (!this.$nav) return;\n    const { direction } = this.properties;\n    this.$nav?.onChange({\n      index,\n      total: this.children.length,\n      direction,\n    });\n  }\n\n  calcOffset(index: number) {\n    const { direction } = this.properties;\n    const { _width, _height } = this.data;\n    if ((direction as any) === DIRECTION.HOR) {\n      return {\n        offsetX: -index * _width,\n      };\n    }\n    return {\n      offsetY: -index * _height,\n    };\n  }\n\n  /**\n   * 下一页\n   * @param opt\n   */\n  next(opt: SwitchOpt) {\n    const innerVal = this.control.get();\n    const len = this.children.length;\n    let nextIndex = innerVal;\n    if (opt.cycle && innerVal === len - 1) {\n      // 最后一个时，跳转第一个\n      nextIndex = 0;\n    } else if (len - 1 > innerVal) {\n      nextIndex += 1;\n    }\n    this.goto(nextIndex, opt.source);\n  }\n\n  /**\n   * 上一页\n   * @param opt\n   */\n  prev(opt: SwitchOpt) {\n    const innerVal = this.control.get();\n    const len = this.children.length;\n    let nextIndex = innerVal;\n    if (opt.cycle && innerVal === 0) {\n      // 第一个时，跳转到最后一个\n      nextIndex = len - 1;\n    } else if (nextIndex > 0) {\n      nextIndex -= 1;\n    }\n    this.goto(nextIndex, opt.source);\n  }\n\n  /**\n   * 内置导航组件，监听按钮点击\n   * @param e\n   */\n  onSwiperNavBtnChange(e) {\n    const { dir, ...rest } = e.detail;\n    this.pause();\n    this?.[dir](rest);\n  }\n}\n"]}