{"version":3,"sources":["../src/navbar/navbar.ts"],"names":[],"mappings":"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","file":"navbar.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\n\nconst { prefix } = config;\nconst name = `${prefix}-navbar`;\n\n@wxComponent()\nexport default class Navbar extends SuperComponent {\n  externalClasses = [\n    't-class',\n    't-class-title',\n    't-class-left',\n    't-class-center',\n    't-class-left-icon',\n    't-class-home-icon',\n    't-class-capsule',\n    't-class-nav-btn',\n  ];\n\n  timer = null;\n\n  options = {\n    addGlobalClass: true,\n    multipleSlots: true,\n  };\n\n  properties = props;\n\n  observers = {\n    visible(this: Navbar, visible) {\n      const { animation } = this.properties;\n      const visibleClass = `${name}${visible ? '--visible' : '--hide'}`;\n      this.setData({\n        visibleClass: `${visibleClass}${animation ? '-animation' : ''}`,\n      });\n      if (this.timer) {\n        clearTimeout(this.timer);\n      }\n      if (animation) {\n        this.timer = setTimeout(() => {\n          this.setData({\n            visibleClass,\n          });\n        }, 300);\n      }\n    },\n    fixed(this: Navbar, fixed) {\n      this.setData({\n        fixedClass: fixed ? `${name}--fixed` : '',\n      });\n    },\n    background(this: Navbar, background) {\n      const list = [];\n      if (background) list.push(`background: ${background}`);\n      this.setData({\n        contentStyle: list.join(';'),\n      });\n    },\n    'homeIcon, leftIcon'(this: Navbar) {\n      this.calcLeftBtn();\n    },\n    'title,titleMaxLength'(this: any) {\n      const { title } = this.properties;\n      const titleMaxLength = this.properties.titleMaxLength || Number.MAX_SAFE_INTEGER;\n      let temp = title.slice(0, titleMaxLength);\n      if (titleMaxLength < title.length) temp += '...';\n      this.setData({\n        showTitle: temp,\n      });\n    },\n  };\n\n  data = {\n    hasHomeIcon: false,\n    hasBackIcon: false,\n\n    classPrefix: name,\n    fixedClass: `${name}--fixed`,\n\n    contentStyle: '',\n    boxStyle: '',\n\n    opacity: 0.1,\n    ios: false,\n    delta: 1,\n    showTitle: '',\n  };\n\n  attached() {\n    this.calcLeftBtn(); // 根据页面栈来决定展示返回按钮还是home按钮\n    // 场景值为1177（视频号直播间）和1175 （视频号profile页）时，小程序禁用了 wx.getMenuButtonBoundingClientRect\n    let rect = null;\n    if (wx.getMenuButtonBoundingClientRect) {\n      rect = wx.getMenuButtonBoundingClientRect();\n    }\n    wx.getSystemInfo({\n      success: (res) => {\n        const ios = !!(res.system.toLowerCase().search('ios') + 1);\n        const navbarHeight = ios ? 44 : 48;\n        const boxStyleList = [];\n        boxStyleList.push(\n          `--narbar-padding-top:${(rect.bottom + rect.top) / 2 - navbarHeight / 2}px;`,\n        );\n        if (rect && res?.windowWidth) {\n          boxStyleList.push(`--navbar-right:${res.windowWidth - rect.left}px;`); // 导航栏右侧小程序胶囊按钮宽度\n        }\n        boxStyleList.push(`--capsule-height:${rect.height}px;`); // 胶囊高度\n        boxStyleList.push(`--capsule-wight:${rect.width}px;`); // 胶囊宽度\n        boxStyleList.push(`--navbar-height:${navbarHeight}px;`); // navbar高度\n        this.setData({\n          ios,\n          boxStyle: boxStyleList.join(';'),\n        });\n      },\n      fail: (err) => {\n        console.error('navbar 获取系统信息失败', err);\n      },\n    });\n  }\n\n  calcLeftBtn() {\n    const { homeIcon, leftIcon } = this.properties as any;\n\n    let home = false;\n    let back = false;\n\n    if (homeIcon) home = true;\n\n    if (leftIcon) back = true;\n    this.setData({\n      hasHomeIcon: home,\n      hasBackIcon: back,\n    });\n  }\n\n  goHome() {\n    this.triggerEvent('go-home');\n  }\n\n  goBack() {\n    const { delta } = this.data;\n    // eslint-disable-next-line\n    const that = this;\n    this.triggerEvent('go-back');\n    if (delta > 0) {\n      wx.navigateBack({\n        delta,\n        fail(e) {\n          that.triggerEvent('fail', e);\n        },\n        complete(e) {\n          that.triggerEvent('complete', e);\n        },\n        success(e) {\n          that.triggerEvent('success', e);\n        },\n      });\n    }\n  }\n}\n"]}