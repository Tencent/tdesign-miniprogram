{"version":3,"sources":["../src/sticky/sticky.ts"],"names":[],"mappings":"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","file":"sticky.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport props from './props';\nimport config from '../common/config';\n\nimport { pageScrollMixin, getRect } from './utils';\n\nconst { prefix } = config;\n\nconst ContainerClass = `.${prefix}-sticky`;\ntype ContainerRef = () => WechatMiniprogram.NodesRef;\n\ninterface StickyProps {\n  zIndex: number;\n  disabled: boolean;\n  container: ContainerRef;\n  offsetTop: number;\n}\n\n@wxComponent()\nexport default class Sticky extends SuperComponent {\n  externalClasses = [`${prefix}-class`];\n\n  properties: StickyProps = props as any;\n\n  behaviors = [\n    pageScrollMixin(function (event) {\n      this.onScroll(event);\n    }),\n  ];\n\n  observers = {\n    'offsetTop, disabled, container': this.onScroll,\n  };\n\n  data = {\n    containerStyle: '',\n    contentStyle: '',\n    classPrefix: `.${prefix}-sticky`,\n  };\n\n  mounted() {\n    this.onScroll();\n  }\n\n  onScroll(event?: { scrollTop: number }) {\n    const { scrollTop } = event || {};\n    const { container, offsetTop, disabled } = this.properties;\n\n    if (disabled) {\n      this.setDataAfterDiff({\n        isFixed: false,\n        transform: 0,\n      });\n      return;\n    }\n\n    this.scrollTop = scrollTop || this.scrollTop;\n\n    if (typeof container === 'function') {\n      Promise.all([getRect(this, ContainerClass), this.getContainerRect()]).then(\n        ([root, container]) => {\n          if (offsetTop + root.height > container.height + container.top) {\n            this.setDataAfterDiff({\n              isFixed: false,\n              transform: container.height - root.height,\n            });\n          } else if (offsetTop >= root.top) {\n            this.setDataAfterDiff({\n              isFixed: true,\n              height: root.height,\n              transform: 0,\n            });\n          } else {\n            this.setDataAfterDiff({ isFixed: false, transform: 0 });\n          }\n        },\n      );\n\n      return;\n    }\n\n    getRect(this, ContainerClass).then((root) => {\n      if (offsetTop >= root.top) {\n        this.setDataAfterDiff({ isFixed: true, height: root.height });\n        this.transform = 0;\n      } else {\n        this.setDataAfterDiff({ isFixed: false });\n      }\n    });\n  }\n\n  setDataAfterDiff(data: { isFixed: boolean; height?: number; transform?: number }) {\n    const { offsetTop } = this.properties;\n    const { containerStyle: prevContainerStyle, contentStyle: prevContentStyle } = this.data;\n    const { isFixed, height, transform } = data;\n    wx.nextTick(() => {\n      let containerStyle = '';\n      let contentStyle = '';\n\n      if (isFixed) {\n        containerStyle += `height:${height}px;`;\n        contentStyle += `position:fixed;top:${offsetTop}px`;\n      }\n      if (transform) {\n        const translate = `translate3d(0, ${transform}px, 0)`;\n        contentStyle += `-webkit-transform:${translate};transform:${translate};`;\n      }\n\n      if (prevContainerStyle !== containerStyle || prevContentStyle !== contentStyle) {\n        this.setData({ containerStyle, contentStyle });\n      }\n\n      this.triggerEvent('scroll', {\n        scrollTop: this.scrollTop,\n        isFixed,\n      });\n    });\n  }\n\n  getContainerRect() {\n    const nodesRef: WechatMiniprogram.NodesRef = this.properties.container();\n    return new Promise<WechatMiniprogram.BoundingClientRectCallbackResult>((resolve) =>\n      nodesRef.boundingClientRect(resolve).exec(),\n    );\n  }\n}\n"]}