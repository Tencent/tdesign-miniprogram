{"version":3,"sources":["../src/tabs/tabs.ts"],"names":[],"mappings":"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","file":"tabs.js","sourcesContent":["import dom from '../behaviors/dom';\nimport touch from '../behaviors/touch';\nimport { SuperComponent, wxComponent } from '../common/src/index';\nimport props from './props';\nimport config from '../common/config';\n\nconst { prefix } = config;\nconst name = `${prefix}-tabs`;\n\nenum Position {\n  top = 'top',\n  right = 'right',\n  bottom = 'bottom',\n  left = 'left',\n}\nconst trackLineWidth = 30;\n@wxComponent()\nexport default class Tabs extends SuperComponent {\n  behaviors = [dom, touch];\n\n  externalClasses = [`${prefix}-class`, `${prefix}-class-item`, `${prefix}-class-active`];\n\n  relations = {\n    './tab-panel': {\n      type: 'descendant' as 'descendant',\n      linked(target: any) {\n        this.children.push(target);\n        target.index = this.children.length - 1;\n        this.updateTabs();\n      },\n      unlinked() {\n        this.children = this.children.map((child: any, index: number) => {\n          child.index = index;\n          return child;\n        });\n        this.updateTabs();\n      },\n    },\n  };\n\n  properties = props;\n\n  observers = {\n    value(name) {\n      if (name !== this.getCurrentName()) {\n        this.setCurrentIndexByName(name);\n      }\n    },\n\n    animation(v) {\n      this.setData({ animate: v });\n    },\n  };\n\n  data = {\n    prefix,\n    classPrefix: name,\n    tabs: [],\n    currentIndex: -1,\n    trackStyle: '',\n    isScrollX: true,\n    isScrollY: false,\n    direction: 'X',\n    animate: { duration: 0 },\n  };\n\n  created() {\n    this.children = this.children || [];\n  }\n\n  attached() {\n    wx.nextTick(() => {\n      this.setTrack();\n    });\n\n    // 根据placement判断scroll-view滚动方向\n    const { placement } = this.properties;\n    let isScrollX = false;\n    let isScrollY = false;\n    if ((placement as any) === Position.top || (placement as any) === Position.bottom) {\n      isScrollX = true;\n    } else {\n      isScrollY = true;\n    }\n    this.setData({\n      isScrollX,\n      isScrollY,\n      direction: isScrollX ? 'X' : 'Y',\n    });\n  }\n\n  updateTabs() {\n    const { children } = this;\n    this.setData({\n      tabs: children.map((child: any) => child.data),\n    });\n    this.setCurrentIndexByName(this.properties.value);\n  }\n\n  setCurrentIndexByName(name) {\n    const { children } = this;\n    const index = children.findIndex((child: any) => child.getComputedName() === `${name}`);\n    if (index > -1) {\n      this.setCurrentIndex(index);\n    }\n  }\n\n  setCurrentIndex(index: number) {\n    if (index <= -1 || index >= this.children.length) return;\n    this.children.forEach((child: any, idx: number) => {\n      const isActive = index === idx;\n      if (isActive !== child.data.active) {\n        child.render(isActive, this);\n      }\n    });\n    if (this.data.currentIndex === index) return;\n    this.setData({\n      currentIndex: index,\n    });\n    this.setTrack();\n  }\n\n  getCurrentName() {\n    if (this.children) {\n      const activeTab = this.children[this.data.currentIndex];\n      if (activeTab) {\n        return activeTab.getComputedName();\n      }\n    }\n  }\n\n  setTrack(color = '#0052d9') {\n    if (!this.properties.showBottomLine) return;\n    const { children } = this;\n    if (!children) return;\n    const { currentIndex, isScrollX, direction } = this.data;\n    if (currentIndex <= -1) return;\n    this.gettingBoundingClientRect(`.${prefix}-tabs__item`, true)\n      .then((res: any) => {\n        const rect = res[currentIndex];\n        if (!rect) return;\n        let count = 0;\n        let distance = 0;\n        // eslint-disable-next-line no-restricted-syntax\n        for (const item of res) {\n          if (count < currentIndex) {\n            distance += isScrollX ? item.width : item.height;\n            count += 1;\n          }\n        }\n\n        if (isScrollX) {\n          distance += (rect.width - trackLineWidth) / 2;\n        }\n        let trackStyle = `background-color: ${color};\n        -webkit-transform: translate${direction}(${distance}px);\n        transform: translate${direction}(${distance}px);\n        -webkit-transition-duration: 0.3s;\n        transition-duration: 0.3s;\n      `;\n        trackStyle += isScrollX ? `width: ${trackLineWidth}px;` : `height: ${rect.height}px;`;\n        this.setData({\n          trackStyle,\n        });\n      })\n      .catch((err) => {\n        this.triggerEvent('error', err);\n      });\n  }\n\n  trigger(eventName: string, index: number) {\n    const currentIndex = index || this.data.currentIndex;\n    const currentTab = this.data.tabs[currentIndex];\n    if (currentTab) {\n      const { value, label } = currentTab;\n      this.triggerEvent(eventName, {\n        value,\n        label,\n        index: currentIndex,\n      });\n    }\n  }\n\n  onTabTap(event: any) {\n    const { index } = event.currentTarget.dataset;\n    const currentTab = this.data.tabs[index];\n    if (!currentTab.disabled && index !== this.data.currentIndex) {\n      this.setCurrentIndex(+index);\n      wx.nextTick(() => {\n        this.trigger('change', index);\n      });\n    }\n  }\n\n  onTouchStart(event: any) {\n    this.touchStart(event);\n  }\n\n  onTouchMove(event: any) {\n    this.touchMove(event);\n  }\n\n  onTouchEnd() {\n    const { direction, deltaX, offsetX } = this;\n    const minSwipeDistance = 50;\n    if (direction === 'horizontal' && offsetX >= minSwipeDistance) {\n      const index = this.getAvailableTabIndex(deltaX);\n      if (index !== -1) {\n        this.setCurrentIndex(index);\n        wx.nextTick(() => {\n          this.trigger('change', index);\n        });\n      }\n    }\n  }\n\n  getAvailableTabIndex(deltaX: number) {\n    const step = deltaX > 0 ? -1 : 1;\n    const { currentIndex, tabs } = this.data;\n    const len = tabs.length;\n    for (let i = step; currentIndex + step >= 0 && currentIndex + step < len; i += step) {\n      const newIndex = currentIndex + i;\n      if (newIndex >= 0 && newIndex < len && tabs[newIndex] && !tabs[newIndex].disabled) {\n        return newIndex;\n      }\n    }\n    return -1;\n  }\n}\n"]}