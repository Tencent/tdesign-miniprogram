{"version":3,"sources":["../src/checkbox-group/checkbox-group.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,cAAc,EAAe,MAAM,qBAAqB,CAAC;AAOlE,MAAM,CAAC,OAAO,OAAO,aAAc,SAAQ,cAAc;IACvD,eAAe,WAAe;IAE9B,SAAS;;;;;MAOP;IAEF,IAAI;;;MAGF;IAEF,UAAU,kDAAS;IAEnB,SAAS;;MAIP;IAEF,SAAS;;MAIP;IAEF,OAAO;;;;;;;;8BAuGiB,MAAM,OAAO,MAAM;;MA0BzC;CACH","file":"checkbox-group.d.ts","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport Props from '../checkbox/checkbox-group-props';\n\nconst { prefix } = config;\nconst name = `${prefix}-checkbox-group`;\n@wxComponent()\nexport default class CheckBoxGroup extends SuperComponent {\n  externalClasses = ['t-class'];\n\n  relations = {\n    '../checkbox/checkbox': {\n      type: 'descendant' as 'descendant',\n      linked() {\n        this.updateChildren();\n      },\n    },\n  };\n\n  data = {\n    classPrefix: name,\n    checkboxOptions: [],\n  };\n\n  properties = Props;\n\n  observers = {\n    value: function () {\n      this.updateChildren('slot');\n    },\n  };\n\n  lifetimes = {\n    attached() {\n      this.handleCreateMulCheckbox();\n    },\n  };\n\n  methods = {\n    // slot插入选项\n    updateChildren(type = 'slot') {\n      let items = [];\n      if (type === 'not-slot') {\n        items = this.selectAllComponents('.t-checkbox-option');\n      } else {\n        items = this.getRelationNodes('../checkbox/checkbox');\n      }\n      const { value, disabled } = this.data;\n      if (items.length > 0) {\n        items.forEach((item: any) => {\n          !item.data.checkAll && item.changeActive(value.indexOf(item.data.value) > -1);\n          item.setDisabled(disabled);\n        });\n        // 关联可全选项\n        if (items.findIndex((item) => item.data.checkAll) > -1) {\n          items.forEach((item) => {\n            item.setOptionLinked(true);\n          });\n          this.handleHalfCheck(type, items.length);\n        }\n      }\n    },\n    updateValue({ name, checked }, type = 'slot') {\n      const { value, max } = this.data;\n      let newValue = value;\n      if (max && checked && newValue.length === max) {\n        return;\n      }\n      if (checked) {\n        newValue = newValue.concat(name);\n      } else {\n        const index = newValue.findIndex((v: string) => v === name);\n        newValue.splice(index, 1);\n      }\n      this.setData({\n        value: newValue,\n      });\n      this.updateChildren(type);\n      this.triggerEvent('change', newValue);\n    },\n    // 支持自定义options\n    handleCreateMulCheckbox() {\n      const { options } = this.data;\n      // 数字数组｜字符串数组｜对像数组\n      if (!options?.length || !Array.isArray(options)) {\n        return;\n      }\n      const optionsValue = [];\n      try {\n        options.forEach((element) => {\n          const typeName = typeof element;\n          if (typeName === 'number' || typeName === 'string') {\n            optionsValue.push({\n              label: `${element}`,\n              value: element,\n            });\n          } else if (typeName === 'object') {\n            optionsValue.push({\n              ...element,\n            });\n          }\n        });\n        this.setData({\n          checkboxOptions: optionsValue,\n        });\n        this.updateChildren('not-slot');\n      } catch (error) {\n        console.error('error', error);\n      }\n    },\n    // 处理全选\n    handleCheckAll(e) {\n      const { checked, option, name, type } = e.detail || e;\n      let items = [];\n      if (type === 'not-slot') {\n        items = this.selectAllComponents('.t-checkbox-option');\n      } else {\n        items = this.getRelationNodes('../checkbox/checkbox');\n      }\n      if (!option) {\n        if (!items?.length) {\n          return;\n        }\n        this.setData({\n          value: items\n            .map((item) => {\n              if (item.data.disabled) {\n                return '';\n              }\n              item.changeActive(checked);\n              return checked && !item.data.checkAll ? item.data.value : '';\n            })\n            .filter((val) => val),\n        });\n        this.triggerEvent('change', this.data.value);\n        this.handleHalfCheck(type, items.length);\n      } else {\n        this.updateValue({ name, checked }, type);\n      }\n    },\n    // 处理options半选\n    handleHalfCheck(type: string, len: number) {\n      let items = [];\n      if (type === 'not-slot') {\n        items = this.selectAllComponents('.t-checkbox-option');\n      } else {\n        items = this.getRelationNodes('../checkbox/checkbox');\n      }\n      const all = items.filter((i) => !i.data.checkAll).map((item) => item.data.value);\n      const currentVal = Array.from(new Set(this.data.value.filter((i) => all.indexOf(i) > -1)));\n      const element = items.find((item) => item.data.checkAll);\n      if (currentVal.length) {\n        element?.changeActive(true);\n        element?.changeCheckAllHalfStatus(currentVal.length !== len - 1);\n      } else {\n        element?.changeActive(false);\n      }\n    },\n    // 设置可全选option选项\n    handleOptionLinked() {\n      const items = this.selectAllComponents('.t-checkbox-option');\n      if (this.data.checkboxOptions.length) {\n        items.forEach((item) => {\n          item.setOptionLinked(true);\n        });\n      }\n    },\n  };\n}\n"]}