{"version":3,"sources":["../src/indexes/indexes.ts"],"names":[],"mappings":"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","file":"indexes.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\n\nconst { prefix } = config;\n\nconst classPrefix = `${prefix}-indexes`;\nconst topOffset = 40; // 滑动选中高亮的顶部偏移(px)\n\n@wxComponent()\nexport default class IndexBar extends SuperComponent {\n  externalClasses = ['t-class', 't-class-index'];\n\n  properties = props;\n\n  observers = {\n    list(this: IndexBar, newValue) {\n      let groups = newValue;\n      // 分组没有title属性时，默认以index作为title\n      if (!!newValue.length && newValue[0].title === undefined) {\n        groups = groups.map((g) => {\n          return { title: g.index, ...g };\n        });\n      }\n      this.setData({ groups });\n    },\n    height(this: IndexBar) {\n      this.getDomInfo();\n    },\n  };\n\n  data = {\n    classPrefix,\n    clientHeight: 0,\n    groups: [],\n    activeGroup: null, // 当前高亮group\n    currentGroup: null, // 当前跳转group\n    showScrollTip: false,\n  };\n\n  timer = null;\n\n  groupTop = null;\n\n  btnBar = null;\n\n  ready() {\n    this.getHeight();\n  }\n\n  getHeight() {\n    wx.getSystemInfo({\n      success: (res) => {\n        this.setData(\n          {\n            clientHeight: res.windowHeight,\n          },\n          this.getDomInfo,\n        );\n      },\n    });\n  }\n\n  getDomInfo() {\n    const query = this.createSelectorQuery();\n    query.select(`#id-${classPrefix}__bar`).boundingClientRect();\n    query.selectAll(`.${classPrefix}__group`).boundingClientRect();\n    query.exec((res) => {\n      if (!res[0]) return;\n      this.btnBar = {\n        top: res[0].top,\n        height: res[0].height,\n        itemHeight: res[0].height / this.data.groups.length,\n      };\n      if (!res[1]) return;\n      // 计算每个group的scrollTop\n      this.groupTop = res[1].map((element) => element.height);\n      this.groupTop.reduce((acc, cur, index) => {\n        const amount = acc + cur;\n        this.groupTop[index] = amount;\n\n        return amount;\n      });\n    });\n  }\n\n  // 通过点击索引的点击位置，判断点击的索引下标位置。\n  computedIndex(tapY) {\n    const offsetY = tapY - this.btnBar.top;\n    let index;\n    if (offsetY < 0) {\n      index = 0;\n    } else if (offsetY > this.btnBar.height) {\n      index = this.data.groups.length - 1;\n    } else {\n      index = Math.floor(offsetY / this.btnBar.itemHeight);\n    }\n    return index;\n  }\n\n  // 通过scroll-view滑动高度计算当前下标位置\n  computedIndexByScrollTop(scrollTop: number): number {\n    if (!this.groupTop) {\n      return -1;\n    }\n\n    return this.groupTop.findIndex((element) => element - topOffset > scrollTop);\n  }\n\n  // 在scroll-view滑动过程中，高亮对应的index\n  activeIndexWhenScroll(scrollTop: number) {\n    const curIndex = this.computedIndexByScrollTop(scrollTop);\n    if (curIndex >= 0) {\n      this.setData({\n        activeGroup: this.data.groups[curIndex],\n      });\n    }\n  }\n\n  scrollToY(tapY) {\n    const index = this.computedIndex(tapY);\n    this.scrollToAnchor(index);\n  }\n\n  scrollToAnchor(index) {\n    this.switchScrollTip(true);\n    const curGroup = this.data.groups[index];\n    this.setData({\n      activeGroup: curGroup,\n      currentGroup: curGroup,\n    });\n  }\n\n  switchScrollTip(val) {\n    val = !!val;\n    const switchFun = (value) => {\n      if (this.data.showScrollTip === value) {\n        return;\n      }\n      this.setData({\n        showScrollTip: value,\n      });\n    };\n    // 关闭tip有延时，开启无延时\n    if (!val) {\n      clearInterval(this.timer);\n      this.timer = setTimeout(() => {\n        switchFun(false);\n      }, 300);\n    } else {\n      switchFun(true);\n    }\n  }\n\n  // 控制触发频率(防抖)\n  throttleScroll() {\n    return new Promise<void>((resolve) => {\n      const delay = 100;\n      const now = Date.now();\n      if (this.lastScrollTime && this.lastScrollTime + delay > now) {\n        if (this.scrollTimer) {\n          clearTimeout(this.scrollTimer);\n        }\n        this.scrollTimer = setTimeout(() => {\n          this.lastScrollTime = now;\n          resolve();\n        }, delay);\n      } else {\n        this.lastScrollTime = now;\n        resolve();\n      }\n    });\n  }\n\n  onTouchStart() {}\n\n  onTouchMove(e) {\n    this.throttleScroll().then(() => this.scrollToY(e.changedTouches[0].pageY));\n  }\n\n  onTouchCancel() {\n    this.switchScrollTip(false);\n  }\n\n  onTouchEnd(e) {\n    this.switchScrollTip(false);\n    this.scrollToY(e.changedTouches[0].pageY);\n  }\n\n  onCellTap(e) {\n    const { indexes } = e.currentTarget.dataset;\n    this.triggerEvent('select', { indexes });\n  }\n\n  onListScroll(e) {\n    this.throttleScroll().then(() => {\n      const { scrollTop } = e.detail;\n      this.activeIndexWhenScroll(scrollTop);\n    });\n  }\n}\n"]}