{"version":3,"sources":["../src/count-down/count-down.ts"],"names":[],"mappings":"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","file":"count-down.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport config from '../common/config';\nimport props from './props';\nimport { isSameSecond, parseFormat, parseTimeData } from './utils';\n\nconst { prefix } = config;\nconst name = `${prefix}-count-down`;\nconst simpleTick = function (fn: (...args: any[]) => void): any {\n  return setTimeout(fn, 30);\n};\n\n@wxComponent()\nexport default class CountDown extends SuperComponent {\n  externalClasses = ['t-class'];\n\n  properties = props;\n\n  observers = {\n    time() {\n      this.reset();\n    },\n  };\n\n  data = {\n    classPrefix: name,\n    timeData: parseTimeData(0),\n    formattedTime: '0',\n  };\n\n  tid: null | number = null;\n\n  detached() {\n    this.destroyed();\n  }\n\n  destroyed() {\n    if (this.tid) {\n      clearTimeout(this.tid);\n      this.tid = null;\n    }\n  }\n\n  // 开始\n  start() {\n    if (this.counting) {\n      return;\n    }\n\n    this.counting = true;\n    this.endTime = Date.now() + this.remain;\n    this.tick();\n  }\n\n  // 暂停\n  pause() {\n    this.counting = false;\n    this.tid && clearTimeout(this.tid);\n  }\n\n  // 重置\n  reset() {\n    this.pause();\n    this.remain = this.properties.time;\n    this.setRemain(this.remain);\n\n    if (this.properties.autoStart) {\n      this.start();\n    }\n  }\n\n  tick() {\n    if (this.properties.millisecond) {\n      this.microTick();\n    } else {\n      this.macroTick();\n    }\n  }\n\n  microTick() {\n    this.tid = simpleTick(() => {\n      this.setRemain(this.getRemain());\n\n      if (this.remain !== 0) {\n        this.microTick();\n      }\n    });\n  }\n\n  macroTick() {\n    this.tid = simpleTick(() => {\n      const remain: number = this.getRemain();\n\n      if (!isSameSecond(remain, this.remain) || remain === 0) {\n        this.setRemain(remain);\n      }\n\n      if (this.remain !== 0) {\n        this.macroTick();\n      }\n    });\n  }\n\n  getRemain(): number {\n    return Math.max(this.endTime - Date.now(), 0);\n  }\n\n  setRemain(remain: number) {\n    this.remain = remain;\n    const timeData = parseTimeData(remain);\n    this.triggerEvent('change', timeData);\n    const { timeText } = parseFormat(remain, this.properties.format as any as string);\n    this.setData({\n      formattedTime: timeText.replace(/:/g, ' : '),\n    });\n\n    if (remain === 0) {\n      this.pause();\n      this.triggerEvent('finish');\n    }\n  }\n}\n"]}