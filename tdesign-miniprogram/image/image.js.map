{"version":3,"sources":["../src/image/image.ts"],"names":[],"mappings":"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","file":"image.js","sourcesContent":["import { SuperComponent, wxComponent } from '../common/src/index';\nimport ImageProps from './props';\nimport config from '../common/config';\n\nconst { prefix } = config;\nconst name = `${prefix}-image`;\n@wxComponent()\nexport default class Image extends SuperComponent {\n  externalClasses = ['t-class', 't-class-load'];\n\n  options = {\n    multipleSlots: true,\n  };\n\n  properties = ImageProps;\n\n  data = {\n    isLoading: true,\n    isFailed: false,\n    widthStyle: '', // 自动计算的图片宽度样式（兼容基础库版本2.10.3以下的版本不支持heightFix模式）\n    classPrefix: name,\n  };\n\n  preSrc = ''; // 保留上一次的src,防止在src相同时重复update\n\n  lifetimes = {\n    attached(this: Image) {\n      this.update();\n    },\n  };\n\n  observers = {\n    src() {\n      if (this.preSrc === this.properties.src) return;\n      this.update();\n    },\n  };\n\n  onLoaded(e: any) {\n    const sdkVersion = wx.getSystemInfoSync().SDKVersion;\n    const versionArray = sdkVersion.split('.').map((v) => parseInt(v, 10));\n    // 版本号低于2.10.3时组件内部实现heightFix模式\n    if (\n      versionArray[0] < 2 ||\n      (versionArray[0] === 2 && versionArray[1] < 10) ||\n      (versionArray[0] === 2 && versionArray[1] === 10 && versionArray[2] < 3)\n    ) {\n      const mode = (this.properties.mode as any) as string;\n      if (mode === 'heightFix') {\n        // 实现heightFix模式，保持高度和宽高比，设置对应的宽度\n        const { height: picHeight, width: picWidth } = e.detail;\n        const query = this.createSelectorQuery();\n        query\n          .select('#image')\n          .boundingClientRect((res) => {\n            const { height } = res;\n            const resultWidth = ((height / picHeight) * picWidth).toFixed(2);\n            this.setData({ widthStyle: `width: ${resultWidth}px;` });\n          })\n          .exec();\n      }\n    }\n    this.setData({\n      isLoading: false,\n      isFailed: false,\n    });\n    this.triggerEvent('load', e.detail);\n  }\n\n  onLoadError(e: any) {\n    this.setData({\n      isLoading: false,\n      isFailed: true,\n    });\n    this.triggerEvent('error', e.detail);\n  }\n\n  update() {\n    const { src } = this.properties as any;\n    this.preSrc = src;\n    if (!src) {\n      // 链接为空时直接触发加载失败\n      this.onLoadError({ errMsg: '图片链接为空' });\n    } else {\n      this.setData({\n        isLoading: true,\n        isFailed: false,\n      });\n    }\n  }\n}\n"]}