<import src="../common/template/button.wxml" />
<wxs src="../common/utils.wxs" module="_" />
<wxs src="./dialog.wxs" module="this" />

<t-popup
  name="dialog"
  custom-style="{{ customStyle }}"
  class="{{classPrefix}}__wrapper"
  visible="{{visible}}"
  showOverlay="{{showOverlay}}"
  closeOnOverlayClick="{{closeOnOverlayClick}}"
  preventScrollThrough="{{preventScrollThrough}}"
  overlayProps="{{overlayProps}}"
  zIndex="{{zIndex}}"
  placement="center"
  bind:visible-change="overlayClick"
>
  <view slot="content" class="{{classPrefix}} {{prefix}}-class">
    <slot name="top" />
    <view class="{{classPrefix}}__content {{prefix}}-class-content">
      <view wx:if="{{title}}" class="{{classPrefix}}__header">{{title}}</view>
      <slot name="title" />
      <view wx:if="{{content}}" class="{{classPrefix}}__body {{title ? '' : classPrefix + '__body--without-title'}}">
        <text class="{{classPrefix}}__body-text">{{content}}</text>
      </view>
      <slot name="content" />
    </view>
    <slot name="middle" />
    <view
      class="{{_.cls(classPrefix + '__footer', [['column', buttonLayout === 'vertical'], ['full', buttonVariant == 'text' && actions.length == 0]])}}"
    >
      <block wx:if="{{actions}}">
        <block wx:for="{{actions}}" wx:key="index">
          <template
            is="button"
            data="{{block: true, type: 'action', extra: index, externalClass: prefix + '-class-action', class: this.getBtnClass(classPrefix, null, buttonLayout), ...item }}"
          />
        </block>
      </block>
      <slot name="actions" />
      <t-button
        wx:if="{{cancelBtn && buttonVariant == 'text'}}"
        block
        variant="text"
        t-class="{{classPrefix}}-button {{prefix}}-class-cancel"
        class="{{_.cls(classPrefix + '__button', ['text', 'cancel'])}}"
        bind:tap="onCancel"
      >
        {{cancelBtn}}
      </t-button>
      <block wx:elif="{{cancelBtn && buttonVariant == 'base'}}">
        <template
          is="button"
          data="{{block: true, type: 'cancel', theme: 'light', externalClass: prefix + '-class-cancel', class: this.getBtnClass(classPrefix, theme, buttonLayout), ..._cancel }}"
        ></template>
      </block>
      <slot name="cancel-btn" />
      <t-button
        wx:if="{{confirmBtn && buttonVariant == 'text'}}"
        block
        variant="text"
        theme="primary"
        t-class="{{classPrefix}}-button {{prefix}}-class-confirm"
        class="{{_.cls(classPrefix + '__button', ['text', 'confirm'])}}"
        bind:tap="onConfirm"
        bind:getuserinfo="openValueCBHandle"
        bind:contact="openValueCBHandle"
        bind:getphonenumber="openValueCBHandle"
        bind:opensetting="openValueCBHandle"
        bind:launchapp="openValueCBHandle"
        bind:error="openValueErrCBHandle"
      >
        {{confirmBtn}}
      </t-button>
      <block wx:elif="{{confirmBtn && buttonVariant == 'base'}}">
        <template
          is="button"
          data="{{block: true, type: 'confirm', theme: 'primary', externalClass: prefix + '-class-confirm', class: this.getBtnClass(classPrefix, theme, buttonLayout), ..._confirm}}"
        ></template>
      </block>
      <slot name="confirm-btn" />
    </view>
  </view>
</t-popup>
