<block>
  <block wx:for="{{nodes}}" wx:for-item="item" wx:for-index="i" wx:key="i">
    <block>
      <!-- blocks -->
      <block wx:if="{{item.type==='heading'}}">
        <view class="{{['t-chat-markdown-h','t-chat-markdown-h'+item.depth]}}"
          ><chat-markdown-node nodes="{{item.tokens}}"></chat-markdown-node
        ></view>
      </block>
      <block wx:elif="{{item.type==='list'}}">
        <view
          class="{{['t-chat-markdown-list',item.ordered?'t-chat-markdown-list__decimal':'']}}"
          data-type="{{item.ordered}}"
        >
          <block wx:for="{{item.items}}" wx:for-item="li" wx:for-index="j" wx:key="j">
            <view class="t-chat-markdown-list-item">
              <block wx:if="{{li.tokens && li.tokens.length}}"
                ><chat-markdown-node nodes="{{li.tokens}}" bind:__l="__l"></chat-markdown-node>
              </block>
              <block wx:else>
                <block>{{''+item.text+''}}</block>
              </block>
            </view>
          </block>
        </view>
      </block>
      <block wx:elif="{{item.type==='paragraph'}}">
        <view class="t-chat-markdown-p"
          ><chat-markdown-node nodes="{{item.tokens}}" bind:__l="__l"></chat-markdown-node>
        </view>
      </block>
      <block wx:elif="{{item.type==='image'}}">
        <view class="t-chat-markdown-image">
          <image src="{{item.href}}" alt="{{item.title}}"></image>
        </view>
      </block>
      <block wx:elif="{{item.type==='table'}}">
        <chat-markdown-table node="{{item}}" bind:__l="__l"></chat-markdown-table>
      </block>
      <block wx:elif="{{item.type==='blockquote'}}">
        <view class="t-chat-markdown-blockquote"
          ><chat-markdown-node nodes="{{item.tokens}}" bind:__l="__l"></chat-markdown-node>
        </view>
      </block>

      <block wx:elif="{{item.type==='code'}}">
        <chat-markdown-code node="{{item}}" theme="{{theme}}" bind:__l="__l"></chat-markdown-code>
      </block>

      <!-- Inlines -->
      <block wx:elif="{{item.type==='text'}}">
        <view class="{{['t-chat-markdown-text','t-chat-markdown-inline']}}" data-raw="{{item.raw}}">
          <block wx:if="{{item.tokens && item.tokens.length}}"
            ><chat-markdown-node nodes="{{item.tokens}}" bind:__l="__l"></chat-markdown-node
          ></block>
          <block wx:else>
            <block>{{''+item.raw+''}}</block>
          </block>
        </view>
      </block>
      <block wx:elif="{{item.type==='strong'}}">
        <view class="{{['t-chat-markdown-strong','t-chat-markdown-inline']}}">
          <block wx:if="{{item.tokens && item.tokens.length}}"
            ><chat-markdown-node nodes="{{item.tokens}}" bind:__l="__l"></chat-markdown-node
          ></block>
          <block wx:else>
            <block>{{''+item.text+''}}</block>
          </block>
        </view>
      </block>
      <block wx:elif="{{item.type==='em'}}">
        <view class="{{['t-chat-markdown-em','t-chat-markdown-inline']}}">
          <block wx:if="{{item.tokens && item.tokens.length}}"
            ><chat-markdown-node nodes="{{item.tokens}}" bind:__l="__l"></chat-markdown-node
          ></block>
          <block wx:else>
            <block>{{''+item.text+''}}</block>
          </block>
        </view>
      </block>
      <block wx:elif="{{item.type==='del'}}">
        <view class="{{['t-chat-markdown-del','t-chat-markdown-inline']}}">
          <block wx:if="{{item.tokens && item.tokens.length}}"
            ><chat-markdown-node nodes="{{item.tokens}}" bind:__l="__l"></chat-markdown-node
          ></block>
          <block wx:else>
            <block>{{''+item.text+''}}</block>
          </block>
        </view>
      </block>
      <block wx:elif="{{item.type==='link'}}">
        <view
          data-event-opts="{{[['link-lick',[['handleClick',['$event','link-tap','$0'],[[['nodes','',i]]]]]]]}}"
          class="{{['t-chat-markdown-link','t-chat-markdown-inline']}}"
          bindlink-lick="linkClick"
        >
          <block wx:if="{{item.tokens && item.tokens.length}}"
            ><chat-markdown-node nodes="{{item.tokens}}" bind:__l="__l"></chat-markdown-node
          ></block>
        </view>
      </block>
      <block wx:elif="{{item.type==='ref'}}">
        <view class="{{['t-chat-markdown-ref','t-chat-markdown-inline']}}"
          ><text class="t-chat-markdown-ref-txt">{{''+item.text+''}}</text></view
        >
      </block>
      <block wx:elif="{{item.type==='space'}}">
        <view class="t-chat-markdown-space"></view>
      </block>
      <block wx:elif="{{item.type==='br'}}">
        <view class="t-chat-markdown-br"></view>
      </block>
      <block wx:elif="{{item.type==='hr'}}">
        <view class="t-chat-markdown-hr"></view>
      </block>
      <block wx:elif="{{item.type==='codespan'}}">
        <view class="{{['t-chat-markdown-codespan','t-chat-markdown-inline']}}" data-type="{{item.type}}">
          {{''+(item.text||item.raw)+''}}
        </view>
      </block>
      <block wx:else>
        <view class="{{['t-chat-markdown-raw','t-chat-markdown-inline']}}" data-type="{{item.type}}">
          {{''+(item.text||item.raw)+''}}
        </view>
      </block>
    </block>
  </block>
</block>
