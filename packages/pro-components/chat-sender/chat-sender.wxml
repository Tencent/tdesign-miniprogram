<wxs src="./chat-sender.wxs" module="_this" />

<view class="{{COMPONENT_NAME}}" style="{{inputStyle}}" bindtap="handleOutsideClick">
  <view class="{{COMPONENT_NAME + '__header'}}" style="{{(attachmentsProps.items && attachmentsProps.items.length > 0)?'margin-top:-8rpx;':''}}">
    <block wx:if="{{attachmentsProps.items && attachmentsProps.items.length > 0}}">
      <view class="{{COMPONENT_NAME + '__attachments'}}">
        <chat-attachments items="{{attachmentsProps.items}}" removable="{{attachmentsProps.removable}}"
          imageViewer="{{attachmentsProps.imageViewer}}" bind:fileClick="handleFileClick" bind:remove="handleFileRemove"
          bind:add="handleFileAdd">
        </chat-attachments>
      </view>
    </block>
    <block wx:else>
      <slot name="header"></slot>
    </block>
  </view>

  <view class="{{COMPONENT_NAME + '__textarea'}} {{focusFlag ? COMPONENT_NAME + '__textarea--focus' : ''}}">
    <view class="textarea-hook">
      <slot name="input-prefix"></slot>
      <textarea class="ipt" style="{{_this.textareaStyle(textareaProps.autosize)}}" disabled="{{disabled}}"
        auto-height="{{!!textareaProps.autosize}}" confirm-type="send" adjust-position="{{false}}"
        disable-default-padding="{{false}}" cursor-spacing="30" maxlength="-1" value="{{value}}" bindchange="textChange"
        bindfocus="focusFn" bindblur="blurFn" bindtap="handlerClick" bindinput="textChange"
        bindkeyboardheightchange="onkeyboardheightchange" bindconfirm="handleSendClick">
      </textarea>
      <view class="placeholder {{focusFlag || value ? 'hide' : ''}}">{{placeholder}}</view>
    </view>

    <view class="{{COMPONENT_NAME + '__footer'}}">
      <view class="{{COMPONENT_NAME + '__mode'}}">
        <slot name="footerPrefix"></slot>
      </view>

      <view class="{{COMPONENT_NAME + '__button'}}">
        <view class="{{COMPONENT_NAME + '__button__sendbtn'}}">
          <block wx:if="{{renderPresets}}">
            <view class="{{COMPONENT_NAME + '__button__sendbtn__default'}}">
              <block wx:for="{{renderPresets}}" wx:for-item="item" wx:for-index="index" wx:key="index">
                <view>
                  <block wx:if="{{item.name === 'upload'}}">
                    <view class="plus-btn {{item.status === 'disabled' ? 'disabled' : ''}}">
                      <block wx:if="{{item.type === 'bottom'}}">
                        <view class="btn-func" catchtap="handleUploadClick" data-type="{{item.type}}"
                          data-status="{{item.status}}">
                          <t-icon name="add" size="40rpx" style="{{visible?'transform:rotate(45deg)':''}}" />
                        </view>
                      </block>
                    </view>
                  </block>

                  <block wx:if="{{item.name === 'send'}}">
                    <block wx:if="{{item.type === 'text'}}">
                      <view class="send-btn-{{item.type}} {{value ? '' : 'disabled'}}" bindtap="handleSendClick">
                        {{loading ? '停止' : '发送'}}
                      </view>
                    </block>
                    <block wx:else>
                      <view
                        class="send-btn-icon send-btn-{{item.type}} {{value ? '' : 'disabled'}} {{loading ? 'stop' : ''}}"
                        bindtap="handleSendClick">
                        <block wx:if="{{!loading}}">
                          <t-icon name="send-filled" size="32rpx" color="#ffffff" />
                        </block>
                        <block wx:else>
                          <view style="width: 24rpx; height: 24rpx; background-color: #ffffff" />
                        </block>
                      </view>
                    </block>
                  </block>
                </view>
              </block>
            </view>
          </block>
          <block wx:else>
            <slot name="suffix"></slot>
          </block>
        </view>
      </view>
    </view>

    <block wx:if="{{visible && uploadPlacement === 'bottom'}}">
      <view class="{{COMPONENT_NAME + '__footer__upload'}}" catchtap="handleUploadClick">
        <block wx:for="{{uploadNames}}" wx:for-item="name" wx:for-index="index" wx:key="index">
          <view class="{{COMPONENT_NAME + '__footer__upload__item'}}" bindtap="handleUploadEntryClick"
            data-name="{{name}}">
            <!-- <view class="{{uploadConfig[name].iconClass}}" style="width: 40rpx; height: 40rpx"></view> -->
            <view class="{{COMPONENT_NAME + '__footer__upload__item__icon'}}">
              <t-icon name="{{uploadConfig[name].iconClass}}" size="42rpx" />
            </view>

            <view class="{{COMPONENT_NAME + '__footer__upload__item__text'}}"> {{uploadConfig[name].text}} </view>
          </view>
        </block>
      </view>
    </block>
  </view>
</view>
