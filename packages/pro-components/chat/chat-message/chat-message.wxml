<wxs src="../../../components/common/utils.wxs" module="_" />

<view class="class {{chatItemClass}}" bindlongpress="handleLongPress" style="{{_._style([style, customStyle])}}">
  <view wx:if="{{showAvatar}}" class="{{COMPONENT_NAME + '__avatar'}}">
    <view class="{{COMPONENT_NAME + '__avatar__box'}}">
      <view wx:if="{{avatar}}">
        <image src="{{avatar}}" class="{{COMPONENT_NAME + '__avatar-image'}}"></image>
      </view>
    </view>
  </view>
  <view class="{{contentClasses}}">
    <view wx:if="{{showName || showDateTime}}" class="{{COMPONENT_NAME + '__base'}}">
      <text wx:if="{{showName}}" class="{{COMPONENT_NAME + '__name'}}">{{name}}</text>
      <text wx:if="{{datetime}}" class="{{COMPONENT_NAME + '__time'}}">{{datetime}}</text>
    </view>
    <block wx:if="{{status === 'pending'}}">
      <view style="width: 100%">
        <chat-loading animation="{{animation}}"></chat-loading>
      </view>
    </block>
    <block wx:else>
      <view class="{{COMPONENT_NAME + '__detail'}}">
        <!-- 属性传值优先级高于content插槽 -->
        <block wx:if="{{content.length > 0}}">
          <block wx:for="{{content}}" wx:key="index">
            <attachments
              wx:if="{{item.type === 'attachment' && role === 'user'}}"
              items="{{item.data}}"
              removable="{{false}}"
              inChat="{{true}}"
            >
            </attachments>
            <chat-thinking wx:if="{{item.type === 'thinking'}}" content="{{item.data}}" role="{{role}}"></chat-thinking>
            <chat-content
              wx:elif="{{item.type === 'text' || item.type === 'markdown'}}"
              content="{{item}}"
              role="{{role}}"
            ></chat-content>
          </block>
        </block>
        <block wx:else>
          <slot name="content" />
        </block>
      </view>
    </block>
    <view wx:if="{{role === 'assistant'}}" class="{{COMPONENT_NAME + '__actionbar-slot'}}">
      <slot name="actionbar"></slot>
    </view>
  </view>
</view>
