<wxs src="./attachments.wxs" module="_this" />
<wxs src="../../../components/common/utils.wxs" module="_" />

<view
  class="{{[''+classPrefix, inChat ? 'inChat' : '', _this.getFileTypeClass(inChat, files)]}}"
  style="{{_._style([style, customStyle])}}"
>
  <view class="{{[classPrefix+'__left-content']}}">
    <view class="{{[classPrefix+'__scrollable-content','scroll-x']}}">
      <block wx:for="{{files}}" wx:for-item="item" wx:for-index="index" wx:key="index">
        <view class="{{[classPrefix+'__file-wrap']}}" bindtap="onFileWrapTap" data-index="{{index}}">
          <block wx:if="{{item.fileType==='image'}}">
            <view class="{{['file-image',classPrefix+'__file']}}">
              <block wx:if="{{item.status==='pending'||item.status==='fail'||item.status==='error'}}">
                <view class="{{[item.status,classPrefix+'__file-status']}}">
                  <t-loading theme="circular" size="24px" class="wrapper" />
                </view>
              </block>
              <block wx:else>
                <image
                  class="image"
                  src="{{item.url}}"
                  mode="{{ _this.getImageMode(item)}}"
                  lazy-load="false"
                  style="{{inChat ? _this.imageStyle(item) : ''}}"
                ></image>
              </block>
              <block wx:if="{{removable}}">
                <t-icon
                  catchtap="onRemoveTap"
                  data-index="{{index}}"
                  class="cancel"
                  name="close-circle-filled"
                  size="16px"
                />
              </block>
            </view>
          </block>
          <block wx:else>
            <view class="{{['file',classPrefix+'__file']}}">
              <view class="image">
                <block wx:if="{{item.status==='pending'}}">
                  <view class="{{['loading',classPrefix+'__file-status']}}">
                    <t-loading theme="circular" size="24px" class="wrapper" />
                  </view>
                </block>
                <block wx:elif="{{item.status==='fail'}}">
                  <view class="{{['fail',classPrefix+'__file-status']}}">
                    <t-loading theme="circular" size="24px" class="wrapper" />
                  </view>
                </block>
                <block wx:elif="{{item.status==='error'}}">
                  <view class="{{['error',classPrefix+'__file-status']}}">
                    <t-loading theme="circular" size="24px" class="wrapper" />
                  </view>
                </block>
                <block wx:else>
                  <t-icon name="{{item.fileIcon.name}}" color="{{item.fileIcon.color}}" size="24"></t-icon>
                </block>
              </view>
              <view class="content">
                <view class="title">{{item.name}}</view>
                <block>
                  <view wx:if="{{item.status==='pending'}}" class="desc">上传中...{{item.progress || 0+"%"}}</view>
                  <view wx:elif="{{item.status==='fail'}}" class="desc">上传失败</view>
                  <view wx:elif="{{item.status==='error'}}" class="desc">{{item.errorMessage}}</view>
                  <view wx:else class="desc">{{item.desc}}</view>
                </block>
              </view>
              <block wx:if="{{removable}}">
                <t-icon
                  catchtap="onRemoveTap"
                  data-index="{{index}}"
                  class="cancel"
                  name="close-circle-filled"
                  size="16px"
                />
              </block>
            </view>
          </block>
        </view>
      </block>
    </view>
  </view>
</view>
