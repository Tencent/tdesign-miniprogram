<view class="chat-box" style="height: {{contentHeight}};">
  <t-chat>
    <block wx:for="{{chatList}}" wx:key="index" wx:for-index="chatIndex">
      <t-chat-message
        avatar="{{item.avatar || ''}}"
        name="{{item.name || ''}}"
        datetime="{{item.datetime || ''}}"
        role="{{item.message.role}}"
        placement="{{item.message.role === 'user' ? 'right' : 'left'}}"
      >
        <view slot="content">
          <block
            wx:for="{{item.message.content}}"
            wx:for-item="contentItem"
            wx:for-index="contentIndex"
            wx:key="contentIndex"
          >
            <t-chat-content
              content="{{contentItem}}"
              wx:if="{{contentItem.type === 'text' || contentItem.type === 'markdown'}}"
            />
            <view class="step" wx:if="{{contentItem.type === 'agent'}}">
              <t-steps layout="vertical" current="{{contentItem.content.steps.length}}">
                <t-step-item wx:for="{{contentItem.content.steps}}" wx:key="index" title="{{item.step}}">
                  <view slot="content" class="step-text-list">
                    <view
                      wx:for="{{item.tasks}}"
                      wx:key="index"
                      wx:for-item="taskItem"
                      class="step-text {{taskItem.type}}"
                    >
                      <t-icon
                        wx:if="{{taskItem.type === 'command'}}"
                        name="control-platform"
                        size="32rpx"
                        class="step-icon"
                      />
                      {{taskItem.text}}
                    </view>
                  </view>
                </t-step-item>
              </t-steps>
            </view>
          </block>
        </view>
        <t-chat-actionbar
          wx:if="{{chatIndex !== chatList.length - 1 && item.message.status === 'complete' && item.message.role === 'assistant'}}"
          slot="actionbar"
          placement="end"
          bind:actions="handleAction"
        />
      </t-chat-message>
    </block>
    <view slot="footer">
      <t-chat-sender
        value="{{value}}"
        loading="{{loading}}"
        disabled="{{disabled}}"
        renderPresets="{{renderPresets}}"
        bind:send="onSend"
        bind:stop="onStop"
        bind:focus="onFocus"
        autoRiseWithKeyboard="{{true}}"
      />
    </view>
  </t-chat>
</view>
<t-toast id="t-toast" />
